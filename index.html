<!DOCTYPE html>
<html lang='en' translate="no">
<head>
    <meta charset='UTF-8', content='notranslate'>
    <title>aInfo</title>
    <meta name='viewport' content='width=device-width, initial-scale=1, viewport-fit=cover'>
    <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' rel='stylesheet'>
    <style>
        body {
            background-color: #0f0f0f;
            color: #ffffff; /* white text */
            padding-bottom: env(safe-area-inset-bottom);
        }
        h1, h2, h3, h4, h5, h6, strong, label {
            color: #ffffff !important;
        }
        .card {
            background-color: #1a1a1a;
            border: none;
        }
        .form-control {
            background-color: #121212;
            color: #ffffff;
            border: 1px solid #333;
        }
        .form-control:focus {
            background-color: #121212;
            color: #ffffff;
            border-color: #0d6efd;
            box-shadow: none;
        }
        .btn {
            min-height: 44px;
        }
        .btn-outline-primary,
        .btn-outline-secondary {
            color: #ffffff;
            border-color: #555;
        }
        .btn-outline-primary:hover,
        .btn-outline-secondary:hover {
            background-color: #333;
            border-color: #666;
        }
        .btn-country.active,
        .btn-year.active {
            background-color: #0d6efd;
            border-color: #0d6efd;
            color: #ffffff;
        }
        .form-check-input {
            background-color: #222;
            border-color: #555;
        }
        .form-check-input:checked {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }
        .form-check-label {
            color: #ffffff; /* captions white */
        }
        @media (max-width: 768px) {
            .mobile-search {
                position: sticky;
                bottom: 0;
                background-color: #111;
                padding: 12px;
                box-shadow: 0 -2px 12px rgba(0,0,0,.6);
                z-index: 1000;
            }
        }
    </style>
</head>
<body>
<div class='container py-3 py-md-5'>
    <div class='row justify-content-center'>
        <div class='col-lg-8'>
            <div class='card shadow-sm'>
                <div class='card-body'>
                    <h3 class='mb-4 text-center'>abroadInfo7</h3>

                    <!-- INPUT -->
                    <div class='mb-3'>
                        <input id='queryInput' type='text' class='form-control form-control-lg' placeholder='Enter search text...' value='Česko'>
                    </div>

                    <!-- COUNTRIES -->
                    <div class='mb-3'>
                        <strong>Country</strong>
                        <div id='countryButtons' class='d-flex flex-wrap gap-2 mt-2'></div>
                    </div>

                    <!-- YEAR -->
                    <div class='mb-3'>
                        <strong>Time limit</strong>
                        <div id='yearButtons' class='d-flex flex-wrap gap-2 mt-2'></div>
                    </div>

                    <!-- EXCLUDE -->
                    <div class='form-check form-switch mb-4'>
                        <input class='form-check-input' type='checkbox' id='excludeSocial' checked>
                        <label class='form-check-label' for='excludeSocial'>Exclude Wiki, X, FB, YT, Insta, Reddit.</label>
                    </div>

                </div>
            </div>

            <!-- MOBILE SEARCH -->
            <div class='mobile-search d-md-none'>
                <button class='btn btn-success w-100 btn-lg' onclick='runSearch()'>Search</button>
            </div>

            <!-- DESKTOP SEARCH -->
            <div class='text-end mt-3 d-none d-md-block'>
                <button class='btn btn-success btn-lg' onclick='runSearch()'>Search</button>
            </div>

        </div>
    </div>
</div>

<script>
/* ===============================
   CONFIG
================================ */
const COUNTRY_CONFIG = {
    //CZ: { lang: 'cs', gl: 'CZ' },
    SK: { lang: 'sk', gl: 'SK' },
    UA: { lang: 'uk', gl: 'UA' },
    US: { lang: 'en', gl: 'US' },
    DE: { lang: 'de', gl: 'DE' },
    AT: { lang: 'de', gl: 'AT' },
    HU: { lang: 'hu', gl: 'HU' },
    PL: { lang: 'pl', gl: 'PL' },    
}

const currentYear = new Date().getFullYear()
const previousYear = currentYear - 1;
const YEAR_RANGES = [
    { label: '<2009', start: null, end: 2009, tbs: 'cdr:1,cd_max:12/31/2008' },
    { label: '2010-2014', start: 2010, end: 2014, tbs: 'cdr:1,cd_min:1/1/2010,cd_max:12/31/2014' },
    { label: '2015-2018', start: 2015, end: 2018, tbs: 'cdr:1,cd_min:1/1/2015,cd_max:12/31/2018' },
    //{ label: '<2009', start: null, end: 2009, tbs: 'cdr:1,cd_max:12/31/2008' },
    //{ label: '2010-2014', start: 2010, end: 2014, : 'cdr:1,cd_min:1/1/2010,cd_max:12/31/2014' },
    //{ label: '2015-2018', start: 2015, end: 2018, tbs: 'cdr:1,cd_min:1/1/2010,cd_max:12/31/2014' },
    //{ label: '2019-2021', start: 2019, end: 2021, tbs: 'cdr:1,cd_min:1/1/2019,cd_max:12/31/2021' },
    //{ label: '2022-' + (previousYear), start: 2022, end: previousYear, tbs: `cdr:1,cd_min:1/1/2022,cd_max:12/31/${previousYear}`},
    //{ label: String(currentYear), start: currentYear, end: currentYear, tbs: `cdr:1,cd_min:1/1/${CURRENT_YEAR},cd_max:12/31/${CURRENT_YEAR}` },
    { label: 'last week', start: currentYear, end: currentYear, tbs: 'qdr:w' },
    { label: 'last 24h', start: currentYear, end: currentYear, tbs: 'qdr:d' }
];

let selectedCountry = localStorage.getItem('lastCountry') || 'CZ'
let selectedYearRangeIndex = localStorage.getItem('lastYearIndex') ? Number(localStorage.getItem('lastYearIndex')) : 2 // default last = currentYear

/* ===============================
   INIT
================================ */
document.addEventListener('DOMContentLoaded', () => {
    createCountryButtons();
    createYearButtons();
    setDefaultQueryFromUrl();
    updateTitleFromInput(); // <-- set title immediately on load
})

/* ===============================
   UI BUILDERS
================================ */
function createCountryButtons() {
    const container = document.getElementById('countryButtons')
    container.innerHTML = ''
    Object.keys(COUNTRY_CONFIG).forEach(code => {
        const btn = document.createElement('button')
        btn.className = 'btn btn-outline-primary btn-country'
        btn.innerText = code
        if(code === selectedCountry) btn.classList.add('active')
        btn.onclick = () => setCountry(btn, code)
        container.appendChild(btn)
    })
}

function createYearButtons() {
    const container = document.getElementById('yearButtons')
    container.innerHTML = ''
    YEAR_RANGES.forEach((range, index) => {
        const btn = document.createElement('button')
        btn.className = 'btn btn-outline-secondary btn-year'
        btn.innerText = range.label
        if(index === selectedYearRangeIndex) btn.classList.add('active')
        btn.onclick = () => setYear(btn, index)
        container.appendChild(btn)
    })
}

/* ===============================
   HANDLERS
================================ */
function setCountry(btn, country) {
    document.querySelectorAll('.btn-country').forEach(b => b.classList.remove('active'))
    btn.classList.add('active')
    selectedCountry = country
    localStorage.setItem('lastCountry', selectedCountry)
    runSearch()
}

function setYear(btn, index) {
    document.querySelectorAll('.btn-year').forEach(b => b.classList.remove('active'))
    btn.classList.add('active')
    selectedYearRangeIndex = index
    localStorage.setItem('lastYearIndex', selectedYearRangeIndex)
    runSearch()
}

/* ===============================
   QUERY FROM URL
================================ */
function setDefaultQueryFromUrl() {
    const params = new URLSearchParams(window.location.search)
    const q = (params.get('q') || '').trim() || 'Česko';
    document.getElementById('queryInput').value = q ? decodeURIComponent(q) : ''
}
function updateTitleFromInput() {
    const text = document.getElementById('queryInput').value.trim() ;
    document.title = 'aInfo' + (text ? ': ' + text : 'Česko');
}
/* ===============================
   SEARCH LOGIC
================================ */
async function runSearch() {
    const text = document.getElementById('queryInput').value.trim()
    //document.title = '1: ' + text;
    if(!text) return
    const lang = COUNTRY_CONFIG[selectedCountry].lang
    try {
        const translated = await translateText(text, lang);
        // Prompt the user to edit/confirm the search query
        let finalText = prompt("Modify the search query if needed:", translated);
        if (!finalText) return;
        openGoogleSearch(finalText)
    } catch {
        openGoogleSearch(text)
    }
}

async function translateText(text, lang) {
    if(lang === 'cs') return text
    const url = 'https://api.mymemory.translated.net/get?q=' + encodeURIComponent(text) + '&langpair=cs|' + lang
    const response = await fetch(url)
    const data = await response.json()
    if(!data.responseData?.translatedText) throw new Error('Translation failed')
    return data.responseData.translatedText
}

function openGoogleSearch(queryText) {
    let query = queryText

    const range = YEAR_RANGES[selectedYearRangeIndex]
    //let tbs = 'cdr:1'
    //if(range.start) tbs += ',cd_min:' + range.start
    //if(range.end) tbs += ',cd_max:' + range.end
    let tbs = range.tbs

    if(document.getElementById('excludeSocial').checked) {
        query += ' -site:facebook.com -site:instagram.com -site:youtube.com -site:x.com -site:wikipedia.org -site:reddit.com'
    }
    query += ' -site:.cz'
    
    

    const cfg = COUNTRY_CONFIG[selectedCountry]
    const url = 'https://www.google.com/search?q=' + encodeURIComponent(query) +
                '&hl=' + cfg.lang +
                '&gl=' + cfg.gl +
                '&tbs=' + encodeURIComponent(tbs)

    window.open(url, '_blank')
}
</script>
</body>
</html>
